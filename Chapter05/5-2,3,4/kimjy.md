## MySQL 엔진의 잠금
- MySQL에서 잠금은 스토리지 엔진 레벨과 MySQL 엔진 레벨로 구분할 수 있음.

### 글로벌 락
- MySQL 전체에 영향을 미칠 수 있는 락
  - 데이터베이스가 다르더라도 영향이 미침 
- SELECT 문을 제외한 대부분의 명령어는, 글로벌 락일 때 대기상태에 머뭄

## 테이블 락
- 개별 테이블 단위로 설정되는 락
- 묵시적 락은 테이블에 데이터를 변경하는 쿼리를 실행하면 발생
- 단 InnoDB의 경우에는 스토리지 엔진에서 레코드 기반의 락이 실행되기 때문에 단순 데이터 변경 쿼리로는 테이블 락이 설정되지 않음

## 네임드 락
- 특정 문자열에 대해 락을 설정할 수 있는 기능

## 메타데이터 락
- 테이블이나 뷰 등 데이터베이스 객체를 변경할 때 발생하는 락
- 테이블의 이름을 변경하는 경우에도 메타데이터 락이 실행

## InnoDB 스토리지 엔진 잠금
- 스토리지 엔진 내부에서는 레코드 기반의 잠금 방식 탑재
- 레코드 기반 잠금이기 때문에 훨씬 뛰어난 동시성 처리 가능
- 레코드 락이 페이지 락 혹은 테이블 락으로 레벨업되는 경우는 없음

### 레코드 락
- 레코드 자체만을 잠그는 락
- 실제로는 레코드가 아닌 인덱스를 락함
  - 레코드를 락하게 되면 테이블을 풀스캔하면서 모든 레코드에 락을 하게 되고, 이를 방지하기 위해 인덱스에 락을 수행

### 갭락
- 레코드와 바로 바로 인접한 레코드 사이(갭)를 락하는 기능
- 레코드와 레코드 사이의 간격에 레코드가 생성되지 않도록 하는 것

### 넥스트 키 락
- 레코드 락과 갭락을 힙쳐놓은 형태
- 레플리카 서버와 소스 서버가 동일하게 기록되기 위해 사용됨
- 이 때문에 데드락이나 트랜잭션 지연이 발생하는 경우가 있음

### 자동 증가락
- AUTO_INCREMENT 컬럼을 위해 사용
- 테이블 수준의 락이 설정
- 당연히도 UPDATE와 DELETE 명령에는 사용되지 않음

## MySQL의 격리 수준
- 트랙잭션의 격리 수준(isolation level)이란 여러 트랜잭션이 동시에 처리될 때 다른 트랜잭션에서 변경하거나 조회하는 데이터를 조회가 가능하게 할 지 말지에 대한 수준이다. 

### READ UNCOMMITTED
- 말 그대로 커밋되지 않은 레코드도 조회할 수 있는 격리 수준
- 트랜잭션 중에 롤백이 되더라도 사용자는 롤백된 정보를 확인할 수 있음.
-  트랜잭션에서 처리한 작업이 완료되지 않았더라도, 다른 트랜잭션에서 레코드를 볼 수 있는 더티 리드(dirty read)가 발생할 수 있음
- 데이터의 정합성을 위해 사용하지 않을 것을 권장

### READ COMMITTED
- 트랜잭션 후 커밋이 완료된 상태의 레코드만 조회가 가능
- 당연히 더티 리드도 발생하지 않음
- 하지만 NON-REPEATABLE READ가 발생
   - REPEATABLE READ란 트랜잭션 내에서 똑같은 SELECT 쿼리는 똑같은 결과를 가져와야 한다는 것
   - 트랜잭션 중에 SELECT한 레코드가 UPDATE에 의해 커밋되면, REPEATABLE READ가 불가능한, NON-REPEATABLE READ가 발생

### REPEATABLE READ
- MySQL의 InnoDB 스토리지 엔진에서 기본으로 사용하는 isolation level
- MySQL에서는 최소 REPEATABLE READ 이상의 격리수준을 사용할 것을 권장
- 이 격리 수준에서는 언두 로그를 활용하여 동일 트랜잭션의 똑같은 SELECT 쿼리는 똑같은 결과를 내보내게 할 수 있음.
- InnoDB에서 트랜잭션은 트랜잭션 번호를 부여받으며, 트랜잭션 번호보다 이전에 변경된 레코드만 읽기가 가능
- 다만 이 격리수준에서는 PHANTOM READ라고 불리우는 데이터 부정합이 발생할 수 있음
   - PHANTOM READ는 트랜잭션 도중에 다른 트랜잭션에서 실행한 작업에 의해 레코드가 보였다가 안보였다가 하는 현상
   - 예를 들어 트랜잭션 중에 다른 트랜잭션이 레코드를 생성한 경우, 동일한 SELECT 작업이라고 하더라도 결과가 추가될 수가 있음

### SERIALIZABLE
- 가장 엄격한 격리 수준
- 읽기 작업 역시 잠금을 수행한 채로 실행됨