## 5-3. InnoDB 스토리지 엔진
- InnoDB 스토리지 엔진은 내부에서 레코드 기반 잠금 방식을 탑재하고 있으며, 레코드 기반이기 때문에 다른 스토리지 엔진보다 동시성 처리 능력이 뛰어나다.
- 이원화된 잠금으로 인해 MySQL 명령으로 접근하기 어려웠지만, InnoDB의 중요도가 높이지면서 InnoDB 잠금에 대한 모니터링 방법도 추가됐다.

### 스토리지 엔진의 잠금
- InnoDB 스토리지 엔진은 레코드 기반 락을 제공한다.
    - <a href='http://wiki.hash.kr/index.php/%EB%A0%88%EC%BD%94%EB%93%9C'>레코드 간단 의미</a>

#### 레코드 락
- 레코드 자체만을 잠그는 것을 의미하며, 다른 DBMS와 다르게 InnoDB는 레코드 자체가 아닌 익덱스의 레코드를 잠근다.

#### 갭 락
- 레코드 자체가 아닌 레코드와 인접한 레코드 사이를 잠근다.
- 갭 락의 역할은 레코드와 레코드 사이의 간격에 새로운 레코드가 생성되는 것을 제어하는 것이다.

#### 넥스트 키 락
- 레코드 락과 갭 락을 합쳐놓은 형태이다.
- STATEMENT 포맷의 바이너리 로그를 사용하는 MySQL 서버에서는 REPEATABLE READ 격리 수준을 사용해야 한다.
- InnoDB의 갭 락이나 넥스트 키 락은 바이너리 로그에 기록되는 쿼리가 레플리카 서버에 실행될 때 소스 서버에서 만들어 낸 결과와 동일한 결과를 만들어내도록 보장하는 것이 주목적이다.

#### 자동 증가 락
- auto_increament 컬럼을 사용하는 테이블을 위한 락
- 새로운 레코드를 생성하는 insert, replace 쿼리 문장에만 락이 걸리며, auto_increament 값을 가져오는 순간 해제된다.
- 한 번 증가된 auto_increament가 줄어들지 않는 이유는 락을 최소화하기 위함이다.

### 인덱스와 잠금
- InnoDB의 잠금은 인덱스의 레코드를 잠그는 방식이므로 명령을 수행하기 위해 관련된 모든 인덱스의 레코드를 잠금한다. 적절한 인덱스가 준비되어 있지 않다면 테이블 전체를 스캔해야 할 수도 있다. InnoDB의 설계가 중요한 이유이다.

### 레코드 수준의 잠금 확인 및 해제
- 레코드 수준의 잠금은 레코드 각각에 잠금이 걸리므로 자주 사용되지 않는 레코드라면 오랜 시간 잠겨진 상태로 남아도 발견되지 않는다.
    - 현재는 레코드 잠금과 잠금 대기에 대한 조회가 가능하다.
- 이전에는 information_schema 라는 DB에서 확인 가능했지만, 현재는 performance_schema의 테이블일 이용해 잠금 확인이 가능하다.