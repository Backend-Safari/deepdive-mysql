## RealMySQL - 4.3 MyISAM 스토리지 엔진 아키텍처

<br>

### 키 캐시

- InnoDB의 버퍼 풀과 비슷한 역할을 하는 것이 MyISAM의 키 캐시


- 키캐시를 이용한 쿼리의 비율(히트율)을 99% 이상으로 유지하라고 권장

<br>

### 운영체제의 캐시 및 버퍼
- MyISAM 테이블의 데이터 읽기나 쓰기 작업은 항상 운영체제의 디스크 읽기 또는 쓰기 작업으로 요청될 수밖에 없다.

- MyISAM이 주로 사용되는 MySQL에서 일반적으로 키 캐시는 최대 물리 메모리의 40% 이상을 넘지 않게 설정하고, 나머지 메모리 공간은 운영체제가 자체적인 파일 시스템을 위한 캐시 공간을 마련할 수 있게 해주는 것이 좋다.

### 데이터 파일과 프라이머리 키(인덱스) 구조

- MyISAM 테이블은 데이터 파일이 힙(Heap) 공간처럼 활용된다.


- MyISAM테이블에서 ROWID는 가변 길이와 고정 길이의 두 가지 방법으로 저장된다.


- 고정 길이 ROWID
    - MAX_ROWS 옵션에 의해 MyISAM 테이블이 가질 수 있는 레코드의 개수가 한정되면 MyISAM 테이블은 ROWID rkqtdmfh 4바이트 정수를 사용한다.


- 가변 길이 ROWID
    - MAX_ROWS 옵션을 설정하지 않으면 MyISAM 테이블의 ROWID는 최대 myisam_data_pointer_size 시스템 변수에 설정된 바이트 수만큼의 공간을 사용할 수 있다.


<br>

## 4.4 MySQL 로그 파일

### 에러로그 파일

- 에러 로그 파일의 위치는 MySQL 설정 파일(my.cnf)에서 log_error라는 이름의 생성됨

- InnoDB의 경우에는 MySQL서버가 서버가 비정상적으로 종료되면, 에러메세지만 보이고 다시 종료된다.
    - 이럴경우 해결하기 어려운 문제점일 때가 많고, 때로는 innodb_force_recovery 파라미터를 0보다 큰 값으로 설정하고 재시작해야만 MySQL이 시작될 수도 있다.

- 에러 로그 파일을 검토하는 것이 데이터베이스의 숨겨진 문제점을 해결하는 데 많이 도움될 것이다.

- max_connect_errors 시스템 변숫값이 너무 낮게 설정된 경우
    - "Host 'host_name'is blocekd"라는 에러가 발생할 수도 있다.
<br>

### 슬로우 쿼리 로그
- log_output 옵션을 이용해 스롤우 쿼리 로그를 파일로 기록하지 테이블로 기록할지 선택할 수 있다.
- 슬로우 쿼리 or 제너럴 로그의 파일내용이 상당히 많아 검토하기 어렵다.
    - 그래서 이런경우 Perconda Toolkit의 pt-query-digest 스크립트를 이용하면 쉽게 빈도나 처리 성능별로 쿼리를 정렬해서 살펴볼 수 있다.